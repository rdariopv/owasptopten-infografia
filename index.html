<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWASP Top 10 (2021) - Infograf√≠a Interactiva</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <!-- 
    PALETTE SELECTION: "Cyber Neon" (Dark Mode Enforced)
    Dark Mode (Fixed):
        Background: #0f172a (Slate 900)
        Surface: #1e293b (Slate 800)
        Primary Text: #f1f5f9 (Slate 100)
        Accent Cyan: #06b6d4 (Cyan 500)
        Accent Pink: #ec4899 (Pink 500)
        Border/Grid: #334155 (Slate 700)
    -->

    <style>
        /* BASE STYLES & FONT */
        body {
            font-family: 'Inter', sans-serif;
        }
        
        h1, h2, h3, .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }

        /* --- DARK MODE (FIJO) --- */
        body.dark {
            background-color: #0f172a; /* Slate 900 */
            color: #f1f5f9; /* Slate 100 */
        }
        /* Custom themed classes for Dark Mode */
        .dark .bg-nav-base { background-color: #0f172a; } /* Navigation base color */
        .dark .bg-surface { background-color: #1e293b; } /* Card/Section background */
        .dark .text-primary { color: #f1f5f9; }
        .dark .text-secondary { color: #94a3b8; }
        .dark .border-primary { border-color: #334155; }
        .dark .chart-grid { border-color: #1e293b !important; }
        .dark .flow-node-bg { background-color: #1e293b !important; border-color: #334155 !important; }

        /* Custom Scrollbar for Dark Mode */
        .dark::-webkit-scrollbar-track { background: #0f172a; }
        .dark::-webkit-scrollbar-thumb { background: #334155; }
        .dark::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Chart Container Base Styles */
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Flow Chart Styles (Pure CSS) */
        .flow-node { position: relative; z-index: 10; }
        .flow-arrow {
            flex-grow: 1; height: 2px; position: relative; margin: 0 10px;
        }
        .flow-arrow::after {
            content: '‚ñ∫';
            position: absolute; right: -6px; top: -10px; font-size: 14px;
        }
        .flow-arrow.default { background: #334155; color: #334155; }
        .flow-arrow.default::after { color: #334155; }
        .flow-arrow.danger { background: #ec4899; color: #ec4899; }
        .flow-arrow.danger::after { color: #ec4899; }
        
        /* Plotly override for dark theme */
        .js-plotly-plot .plotly .modebar {
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* Aseguramos que los hover effects se vean bien sin la clase light */
        .bg-surface:hover {
             background-color: #334155; /* Un tono m√°s claro de slate 700 al pasar el rat√≥n */
             transition: background-color 0.3s;
        }
    </style>
</head>
<!-- Clase 'dark' fija -->
<body class="antialiased overflow-x-hidden dark">

    <!-- Navigation / Header -->
    <nav class="sticky top-0 z-50 bg-nav-base/90 backdrop-blur-md border-b border-primary shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-cyan-500 text-2xl mr-2">üõ°Ô∏è</span>
                    <span class="font-bold text-xl tracking-tight text-primary mono-font">OWASP <span class="text-cyan-500">TOP 10</span></span>
                </div>
                <div class="flex items-center">
                    <div class="hidden md:block text-sm text-secondary mr-4">
                        Edici√≥n 2021
                    </div>
                    
                    <!-- Bot√≥n de tema eliminado seg√∫n solicitud del usuario -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative dark:bg-slate-900 overflow-hidden">
        <div class="absolute inset-0">
            <div class="absolute inset-0 dark:bg-gradient-to-br from-cyan-900/20 to-pink-900/20"></div>
        </div>
        <div class="relative max-w-7xl mx-auto py-24 px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-pink-500 mb-6">
                Riesgos Cr√≠ticos de Seguridad Web
            </h1>
            <p class="mt-4 max-w-2xl mx-auto text-xl text-secondary">
                Una gu√≠a visual esencial para entender las vulnerabilidades m√°s peligrosas seg√∫n OWASP. Protege tu arquitectura, valida tus datos y asegura tus accesos.
            </p>
            <div class="mt-8 flex justify-center gap-4">
                <div class="bg-surface border border-primary p-4 rounded-lg shadow-lg">
                    <span class="block text-3xl font-bold text-cyan-500">10</span>
                    <span class="text-xs text-secondary uppercase tracking-widest">Vulnerabilidades</span>
                </div>
                <div class="bg-surface border border-primary p-4 rounded-lg shadow-lg">
                    <span class="block text-3xl font-bold text-pink-500">2021</span>
                    <span class="text-xs text-secondary uppercase tracking-widest">Versi√≥n Vigente</span>
                </div>
            </div>
            
            <!-- Bot√≥n de GitHub para el repositorio fuente de OWASP -->
            <div class="mt-8">
                <a href="https://github.com/owasp/www-project-top-ten" target="_blank" rel="noopener noreferrer" 
                   class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-full shadow-xl text-white dark:bg-cyan-500 dark:hover:bg-cyan-600 transition duration-300 ease-in-out transform hover:scale-105 mono-font">
                    <span class="mr-2 text-xl">üîó</span>
                    Ver Repositorio Oficial (GitHub)
                </a>
            </div>
            <!-- FIN Bot√≥n -->

        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-24">

        <!-- SECTION 1: The Ranking (Bar Chart) -->
        <section>
            <div class="md:flex md:items-center md:justify-between mb-8">
                <div class="md:w-2/3">
                    <h2 class="text-3xl font-bold text-primary mb-4 border-l-4 border-cyan-500 pl-4">El Ranking Oficial</h2>
                    <p class="text-secondary text-lg leading-relaxed">
                        El Top 10 no es aleatorio; refleja la frecuencia, severidad y potencial de impacto de cada riesgo. En 2021, vimos cambios dr√°sticos: <strong>Broken Access Control</strong> subi√≥ al primer puesto, superando a las inyecciones tradicionales.
                    </p>
                </div>
            </div>

            <div class="bg-surface rounded-xl shadow-2xl p-6 border border-primary">
                <!-- Chart Container: Responsive height logic handled here and in script -->
                <div class="chart-container h-[400px] md:h-[500px] w-full max-w-5xl mx-auto">
                    <canvas id="rankingChart"></canvas>
                </div>
                <p class="mt-4 text-center text-sm text-secondary italic">
                    Fuente: OWASP Top 10 - 2021. Los valores representan la posici√≥n inversa (M√°s alto = Mayor Riesgo).
                </p>
            </div>
        </section>

        <!-- SECTION 2: Deep Dive Top 3 (Cards + Radar) -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
            <div>
                <h2 class="text-3xl font-bold text-primary mb-6 border-l-4 border-pink-500 pl-4">An√°lisis de los "3 Grandes"</h2>
                <p class="text-secondary mb-8">
                    Estos tres riesgos representan la mayor amenaza actual. Comparamos sus perfiles bas√°ndonos en <strong>Explotabilidad</strong> (qu√© tan f√°cil es atacar), <strong>Prevalencia</strong> (qu√© tan com√∫n es) e <strong>Impacto T√©cnico</strong> (da√±o potencial).
                </p>
                
                <div class="space-y-4">
                    <!-- Card 1 -->
                    <div class="bg-surface p-4 rounded-lg border-l-4 border-cyan-500 hover:bg-slate-700">
                        <h3 class="text-lg font-bold text-cyan-500">1. Broken Access Control</h3>
                        <p class="text-sm text-secondary">Usuarios actuando fuera de sus permisos permitidos. Es el riesgo #1 por su ubicuidad.</p>
                    </div>
                    <!-- Card 2 -->
                    <div class="bg-surface p-4 rounded-lg border-l-4 border-violet-500 hover:bg-slate-700">
                        <h3 class="text-lg font-bold text-violet-500">2. Cryptographic Failures</h3>
                        <p class="text-sm text-secondary">Datos sensibles expuestos por cifrado d√©bil o inexistente. Antes conocido como "Sensitive Data Exposure".</p>
                    </div>
                    <!-- Card 3 -->
                    <div class="bg-surface p-4 rounded-lg border-l-4 border-pink-500 hover:bg-slate-700">
                        <h3 class="text-lg font-bold text-pink-500">3. Injection</h3>
                        <p class="text-sm text-secondary">Datos no confiables enviados a int√©rpretes (SQL, OS, NoSQL). Baj√≥ al puesto 3 pero sigue siendo devastador.</p>
                    </div>
                </div>
            </div>

            <!-- Radar Chart Container -->
            <div class="bg-surface rounded-xl shadow-xl p-6 border border-primary flex flex-col justify-center items-center">
                <h4 class="text-secondary mb-4 font-bold tracking-wide uppercase text-sm">Perfil de Amenaza</h4>
                <div class="chart-container w-full max-w-md h-[350px] md:h-[400px]">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Risk Matrix (Plotly Scatter) -->
        <section>
            <h2 class="text-3xl font-bold text-primary mb-4 border-l-4 border-violet-500 pl-4">Matriz de Riesgo: Impacto vs. Probabilidad</h2>
            <p class="text-secondary mb-8 max-w-3xl">
                Visualizaci√≥n de los 10 riesgos distribuidos en una matriz cl√°sica de seguridad. Los elementos en la esquina superior derecha (Alta Probabilidad, Alto Impacto) requieren atenci√≥n inmediata.
            </p>
            
            <div class="bg-surface rounded-xl shadow-2xl p-4 border border-primary overflow-hidden">
                <!-- Plotly Container -->
                <div id="riskMatrix" class="w-full h-[500px] max-w-6xl mx-auto"></div>
            </div>
        </section>

        <!-- SECTION 4: Anatomy of a Vulnerability (CSS Flow) -->
        <section class="flow-node-bg rounded-2xl border border-primary p-8 shadow-inner">
            <h2 class="text-2xl md:text-3xl font-bold text-primary mb-2 text-center">Anatom√≠a: Broken Access Control</h2>
            <p class="text-center text-secondary mb-10 max-w-2xl mx-auto">
                ¬øC√≥mo ocurre realmente? Un usuario normal manipula una URL o ID para acceder a recursos de administrador sin que el servidor verifique los permisos.
            </p>

            <!-- CSS Flow Diagram -->
            <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-0 max-w-5xl mx-auto">
                
                <!-- Node 1 -->
                <div class="flow-node bg-surface p-6 rounded-lg text-center w-full md:w-48 shadow-lg border border-primary">
                    <div class="text-3xl mb-2">üë§</div>
                    <div class="font-bold text-primary">Atacante</div>
                    <div class="text-xs text-secondary">Usuario Logueado<br>(ID: 101)</div>
                </div>

                <!-- Arrow -->
                <div class="hidden md:block flow-arrow default"></div>
                <div class="md:hidden text-2xl dark:text-slate-500">‚¨áÔ∏è</div>

                <!-- Node 2 -->
                <div class="flow-node bg-surface p-6 rounded-lg text-center w-full md:w-64 border-2 border-dashed border-pink-500 dark:shadow-[0_0_15px_rgba(236,72,153,0.2)]">
                    <div class="text-3xl mb-2">üåê</div>
                    <div class="font-bold text-pink-500">Petici√≥n Manipulada</div>
                    <code class="block mt-2 dark:bg-black/50 p-2 rounded text-xs text-pink-500 font-mono">GET /admin/delete?id=5</code>
                    <div class="text-xs text-red-500 mt-1 font-bold">‚ö†Ô∏è FALTA VALIDACI√ìN</div>
                </div>

                <!-- Arrow -->
                <div class="hidden md:block flow-arrow danger"></div>
                <div class="md:hidden text-2xl text-pink-500">‚¨áÔ∏è</div>

                <!-- Node 3 -->
                <div class="flow-node bg-surface p-6 rounded-lg text-center w-full md:w-48 shadow-lg border border-primary">
                    <div class="text-3xl mb-2">üóÑÔ∏è</div>
                    <div class="font-bold text-primary">Base de Datos</div>
                    <div class="text-xs text-secondary">Ejecuta acci√≥n administrativa</div>
                </div>

            </div>
        </section>

        <!-- SECTION 5: The Full Breakdown (Grid) -->
        <section>
            <h2 class="text-3xl font-bold text-primary mb-8 border-l-4 border-green-500 pl-4">El Resto del Top 10</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Card 4 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-blue-500">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">4. Insecure Design</h3>
                        <span class="text-xs dark:bg-blue-900 dark:text-blue-300 px-2 py-1 rounded">Arquitectura</span>
                    </div>
                    <p class="text-secondary text-sm">No es un bug de c√≥digo, sino una falla en el dise√±o. Falta de modelado de amenazas o patrones de dise√±o inseguros.</p>
                </div>

                <!-- Card 5 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-yellow-500">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">5. Security Misconfiguration</h3>
                        <span class="text-xs dark:bg-yellow-900 dark:text-yellow-300 px-2 py-1 rounded">Config</span>
                    </div>
                    <p class="text-secondary text-sm">Permisos por defecto, headers HTTP faltantes, mensajes de error con trazas completas. Muy com√∫n en Cloud.</p>
                </div>

                <!-- Card 6 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-orange-500">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">6. Vuln. & Outdated Components</h3>
                        <span class="text-xs dark:bg-orange-900 dark:text-orange-300 px-2 py-1 rounded">Supply Chain</span>
                    </div>
                    <p class="text-secondary text-sm">Uso de librer√≠as o frameworks (npm, pip, maven) con CVEs conocidos. ¬°Actualiza tus dependencias!</p>
                </div>

                <!-- Card 7 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-red-500">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">7. Ident. & Auth Failures</h3>
                        <span class="text-xs dark:bg-red-900 dark:text-red-300 px-2 py-1 rounded">Auth</span>
                    </div>
                    <p class="text-secondary text-sm">Permitir fuerza bruta, no usar MFA, gesti√≥n de sesiones d√©bil o exposici√≥n de IDs de sesi√≥n en URL.</p>
                </div>

                <!-- Card 8 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-indigo-500">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">8. Software & Data Integrity</h3>
                        <span class="text-xs dark:bg-indigo-900 dark:text-indigo-300 px-2 py-1 rounded">CI/CD</span>
                    </div>
                    <p class="text-secondary text-sm">C√≥digo o datos modificados sin detecci√≥n. Incluye actualizaciones inseguras y pipelines CI/CD comprometidos.</p>
                </div>

                <!-- Card 9 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-gray-500">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">9. Logging & Monitoring Failures</h3>
                        <span class="text-xs dark:bg-gray-700 dark:text-gray-300 px-2 py-1 rounded">Ops</span>
                    </div>
                    <p class="text-secondary text-sm">La incapacidad de detectar una brecha activa. Sin logs, los atacantes tienen tiempo infinito.</p>
                </div>

                <!-- Card 10 -->
                <div class="bg-surface rounded-lg p-6 shadow-md border-t-4 border-teal-500 lg:col-span-3">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-primary">10. Server-Side Request Forgery (SSRF)</h3>
                        <span class="text-xs dark:bg-teal-900 dark:text-teal-300 px-2 py-1 rounded">Network</span>
                    </div>
                    <p class="text-secondary text-sm">Enga√±ar al servidor para que haga peticiones a recursos internos (AWS metadata, redes privadas) que no deber√≠an ser accesibles desde fuera.</p>
                </div>

            </div>
        </section>

        <!-- SECTION 6: Official OWASP Resources -->
        <section id="resources" class="py-12 border-t border-primary">
            <h2 class="text-3xl font-bold text-primary mb-8 border-l-4 border-indigo-500 pl-4">Recursos Oficiales de OWASP</h2>
            <p class="text-secondary mb-8 max-w-3xl">
                Profundiza en cada tema utilizando la documentaci√≥n oficial de OWASP, esencial para desarrolladores, testers y arquitectos de seguridad.
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Link 1: OWASP Top 10 (English) -->
                <a href="https://owasp.org/Top10/" target="_blank" rel="noopener noreferrer" class="block bg-surface rounded-lg p-6 shadow-lg border border-primary hover:bg-slate-700">
                    <h3 class="text-xl font-bold text-cyan-500 mb-2">OWASP Top 10 (Original)</h3>
                    <p class="text-secondary text-sm">Documentaci√≥n oficial y an√°lisis de riesgos en ingl√©s.</p>
                    <span class="mt-3 block text-xs text-secondary mono-font">owasp.org/Top10/</span>
                </a>

                <!-- Link 2: OWASP Top 10 (Spanish) -->
                <a href="https://owasp.org/Top10/es/" target="_blank" rel="noopener noreferrer" class="block bg-surface rounded-lg p-6 shadow-lg border border-primary hover:bg-slate-700">
                    <h3 class="text-xl font-bold text-cyan-500 mb-2">OWASP Top 10 (Espa√±ol)</h3>
                    <p class="text-secondary text-sm">Traducci√≥n oficial al idioma espa√±ol.</p>
                    <span class="mt-3 block text-xs text-secondary mono-font">owasp.org/Top10/es/</span>
                </a>

                <!-- Link 3: OWASP Dev Guide -->
                <a href="https://devguide.owasp.org/" target="_blank" rel="noopener noreferrer" class="block bg-surface rounded-lg p-6 shadow-lg border border-primary hover:bg-slate-700">
                    <h3 class="text-xl font-bold text-cyan-500 mb-2">OWASP Developer Guide</h3>
                    <p class="text-secondary text-sm">Gu√≠a completa para desarrollar aplicaciones seguras.</p>
                    <span class="mt-3 block text-xs text-secondary mono-font">devguide.owasp.org/</span>
                </a>

                <!-- Suggested Link 4: ASVS -->
                <a href="https://owasp.org/www-project-application-security-verification-standard/" target="_blank" rel="noopener noreferrer" class="block bg-surface rounded-lg p-6 shadow-lg border border-primary hover:bg-slate-700">
                    <h3 class="text-xl font-bold text-violet-500 mb-2">ASVS: Verification Standard</h3>
                    <p class="text-secondary text-sm">El est√°ndar para verificar y probar la seguridad de las aplicaciones.</p>
                    <span class="mt-3 block text-xs text-secondary mono-font">owasp.org/www-project-asvs/</span>
                </a>
                
                <!-- Suggested Link 5: Cheat Sheet Series -->
                <a href="https://cheatsheetseries.owasp.org/" target="_blank" rel="noopener noreferrer" class="block bg-surface rounded-lg p-6 shadow-lg border border-primary hover:bg-slate-700">
                    <h3 class="text-xl font-bold text-violet-500 mb-2">Cheat Sheet Series</h3>
                    <p class="text-secondary text-sm">Colecci√≥n de gu√≠as r√°pidas y pr√°cticas sobre temas de seguridad espec√≠ficos.</p>
                    <span class="mt-3 block text-xs text-secondary mono-font">cheatsheetseries.owasp.org/</span>
                </a>
            </div>
        </section>


        <!-- Conclusion -->
        <footer class="mt-20 border-t border-primary pt-10 text-center pb-10">
            <h3 class="text-2xl font-bold text-primary mb-4">Seguridad por Dise√±o, no por Accidente</h3>
            <p class="text-secondary max-w-2xl mx-auto mb-6">
                El OWASP Top 10 es un mapa, no el territorio. Utiliza esta lista como punto de partida para auditor√≠as, capacitaciones y mejoras en tu ciclo de desarrollo de software seguro (SDLC).
            </p>
            <!-- Atribuci√≥n en el footer con enlace personal -->
            <div class="text-xs dark:text-slate-600">
                Dise√±o y Contenido basado en OWASP Top 10 - 2021. 
                <a href="https://github.com/rdariopv" target="_blank" class="text-cyan-500 hover:text-cyan-400">
                    Creado por rdariopv
                </a> 
                (Powered by Gemini AI).
            </div>
            <!-- FIN Atribuci√≥n -->
        </footer>

    </main>

    <script>
        // Variables globales para las instancias de Chart.js
        let rankingChartInstance = null;
        let radarChartInstance = null;
        
        // --- DATA: OWASP Top 10 Items (Declarado globalmente para evitar ReferenceError) ---
        const rawLabels = [
            "Broken Access Control",
            "Cryptographic Failures",
            "Injection",
            "Insecure Design",
            "Security Misconfiguration",
            "Vuln. & Outdated Components",
            "Ident. & Auth Failures",
            "Software & Data Integrity",
            "Logging & Monitoring Failures",
            "SSRF"
        ];
        
        // --- UTILITY: Label Wrapping Logic (>16 chars) ---
        function wrapLabels(labels) {
            return labels.map(label => {
                if (label.length > 16) {
                    const words = label.split(' ');
                    const lines = [];
                    let currentLine = words[0];

                    for (let i = 1; i < words.length; i++) {
                        // Verifica si agregar la siguiente palabra excede el l√≠mite
                        if ((currentLine + " " + words[i]).length <= 16) {
                            currentLine += " " + words[i];
                        } else {
                            // Si excede, guarda la l√≠nea actual e inicia una nueva
                            lines.push(currentLine);
                            currentLine = words[i];
                        }
                    }
                    lines.push(currentLine);
                    return lines;
                }
                return label;
            });
        }
        
        // Process labels for wrapping (Declarado aqu√≠ para usar la funci√≥n wrapLabels sin problema)
        const processedLabels = wrapLabels(rawLabels);

        // --- CHART RENDERING LOGIC ---
        
        function renderCharts() {
            // Theme parameters fixed to 'dark' for stability
            const isDark = true; 

            // --- Chart.js Defaults based on the fixed Dark Theme ---
            const primaryTextColor = '#f1f5f9'; // Slate 100
            const secondaryTextColor = '#94a3b8'; // Slate 400
            const gridColor = '#334155'; // Slate 700
            const surfaceColor = 'rgba(30, 41, 59, 0.9)'; // Slate 800

            Chart.defaults.color = secondaryTextColor;
            Chart.defaults.borderColor = gridColor;
            Chart.defaults.font.family = "'Inter', sans-serif";

            const tooltipPlugin = {
                tooltip: {
                    backgroundColor: surfaceColor,
                    titleColor: '#06b6d4', // Cyan 500
                    bodyColor: primaryTextColor,
                    borderColor: gridColor,
                    borderWidth: 1,
                    padding: 10,
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            // Reconstruye el texto si se dividi√≥ en l√≠neas
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            } else {
                                return label;
                            }
                        }
                    }
                }
            };
            
            // Destruir instancias previas si existen
            if (rankingChartInstance) rankingChartInstance.destroy();
            if (radarChartInstance) radarChartInstance.destroy();


            // --- CHART 1: Horizontal Bar (Ranking) ---
            const ctxRanking = document.getElementById('rankingChart').getContext('2d');
            rankingChartInstance = new Chart(ctxRanking, {
                type: 'bar',
                data: {
                    // processedLabels ahora se accede de forma segura como variable global
                    labels: processedLabels, 
                    datasets: [{
                        label: 'Severidad Relativa (Posici√≥n Invertida)',
                        backgroundColor: [
                            '#06b6d4', // Cyan (Rank 1)
                            '#8b5cf6', // Violet
                            '#ec4899', // Pink
                            '#3b82f6', // Blue
                            '#eab308', // Yellow
                            '#f97316', // Orange
                            '#ef4444', // Red
                            '#6366f1', // Indigo
                            '#64748b', // Slate
                            '#14b8a6'  // Teal (Rank 10)
                        ],
                        data: [10, 9, 8, 7, 6, 5, 4, 3, 2, 1], // Inverted rank for visual size
                        borderRadius: 4,
                        barPercentage: 0.7
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { display: true, color: gridColor },
                            title: { display: true, text: 'Nivel de Prioridad', color: primaryTextColor }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: primaryTextColor }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        ...tooltipPlugin
                    }
                }
            });

            // --- CHART 2: Radar Chart (Top 3 Comparison) ---
            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            const radarLabels = wrapLabels(["Exploitability", "Prevalence", "Detectability", "Tech Impact"]);
            
            radarChartInstance = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: radarLabels,
                    datasets: [
                        {
                            label: 'Access Control',
                            data: [8, 9, 6, 8],
                            backgroundColor: 'rgba(6, 182, 212, 0.2)', // Cyan 500, 20%
                            borderColor: '#06b6d4', // Cyan 500
                            pointBackgroundColor: '#06b6d4'
                        },
                        {
                            label: 'Crypto Failures',
                            data: [6, 7, 4, 9], 
                            backgroundColor: 'rgba(139, 92, 246, 0.2)', // Violet 500, 20%
                            borderColor: '#8b5cf6', // Violet 500
                            pointBackgroundColor: '#8b5cf6'
                        },
                        {
                            label: 'Injection',
                            data: [9, 7, 8, 9], 
                            backgroundColor: 'rgba(236, 72, 153, 0.2)', // Pink 500, 20%
                            borderColor: '#ec4899', // Pink 500
                            pointBackgroundColor: '#ec4899'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: gridColor },
                            grid: { color: gridColor },
                            pointLabels: { color: primaryTextColor, font: { size: 11 } },
                            suggestedMin: 0,
                            suggestedMax: 10,
                            ticks: { backdropColor: '#1e293b', color: secondaryTextColor } // Slate 800 background
                        }
                    },
                    plugins: {
                        legend: { labels: { color: primaryTextColor } },
                        ...tooltipPlugin
                    }
                }
            });
            
            // --- CHART 3: Plotly Risk Matrix (Scatter WebGL) ---
            
            const trace1 = {
                x: [9, 6, 8, 7, 7, 8, 7, 6, 5, 4], // Likelihood (Prevalence)
                y: [8, 9, 9, 7, 6, 6, 5, 8, 5, 6], // Technical Impact
                text: rawLabels,
                mode: 'markers+text',
                type: 'scatter',
                textposition: 'top center',
                marker: {
                    size: [25, 22, 22, 18, 16, 15, 14, 14, 12, 10],
                    color: [
                        '#06b6d4', '#8b5cf6', '#ec4899', '#3b82f6', 
                        '#eab308', '#f97316', '#ef4444', '#6366f1', 
                        '#64748b', '#14b8a6'
                    ],
                    opacity: 0.8,
                    line: { color: primaryTextColor, width: 1 }
                },
                textfont: {
                    family: 'Inter, sans-serif',
                    color: primaryTextColor 
                }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)', // Transparente
                plot_bgcolor: 'rgba(30, 41, 59, 0.5)', // Slate 800 semi-transparente
                margin: { t: 20, r: 20, b: 50, l: 50 },
                xaxis: {
                    title: 'Probabilidad / Prevalencia',
                    range: [0, 10],
                    color: secondaryTextColor,
                    gridcolor: gridColor,
                    zerolinecolor: gridColor,
                    showline: true,
                    linecolor: gridColor
                },
                yaxis: {
                    title: 'Impacto T√©cnico',
                    range: [0, 10],
                    color: secondaryTextColor,
                    gridcolor: gridColor,
                    zerolinecolor: gridColor,
                    showline: true,
                    linecolor: gridColor
                },
                showlegend: false,
                hovermode: 'closest',
                font: { color: primaryTextColor }
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                renderer: 'canvas' // Request canvas rendering
            };

            Plotly.newPlot('riskMatrix', [trace1], layout, config);
        }
        
        // Initial chart render on load (Ya no depende de setTheme, se llama directamente)
        window.onload = function() {
            renderCharts();
        };

    </script>
</body>
</html>
